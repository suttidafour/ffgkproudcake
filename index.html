<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pastel Cake Wishes - Realtime</title>
<style>
body {
  margin: 0;
  height: 100vh;
  font-family: sans-serif;
  background: linear-gradient(135deg, #fde2e4, #e0fbfc);
  overflow: hidden;
  position: relative;
}

/* ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
.screen { width: 100%; max-width: 720px; text-align: center; padding: 20px; display: none; }
.screen.active { display: block; animation: fadeIn 0.6s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.intro h1 { font-size: 36px; margin-bottom: 20px; }
.intro input {
  width: 80%;
  padding: 14px;
  font-size: 16px;
  border-radius: 25px;
  border: none;
  outline: none;
  text-align: center;
  margin-bottom: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,.1);
}
.intro button {
  padding: 12px 26px;
  font-size: 16px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  background: #ffc8dd;
  box-shadow: 0 4px 10px rgba(0,0,0,.2);
}

/* ‡πÇ‡∏ã‡∏ô‡πÅ‡∏≠‡∏õ‡∏´‡∏•‡∏±‡∏Å */
.app input {
  width: 90%;
  padding: 14px;
  font-size: 16px;
  border-radius: 25px;
  border: none;
  outline: none;
  text-align: center;
  margin-bottom: 10px;
  box-shadow: 0 4px 10px rgba(0,0,0,.1);
}
.add-btn {
  padding: 12px 26px;
  margin-bottom: 14px;
  border-radius: 30px;
  border: none;
  cursor: pointer;
  font-size: 16px;
  background: #ffafcc;
  box-shadow: 0 4px 10px rgba(0,0,0,.2);
}

.controls {
  margin-bottom: 15px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
}
.color-picker { display: flex; gap: 8px; }
.color-btn {
  width: 26px;
  height: 26px;
  border-radius: 50%;
  cursor: pointer;
  border: 2px solid transparent;
  box-shadow: 0 3px 6px rgba(0,0,0,.2);
}
.color-btn.active { border-color: #333; }

button { 
  padding: 8px 14px; 
  border-radius: 20px; 
  border: none; 
  font-size: 14px; 
  cursor: pointer; 
  background: #ffc8dd; 
  box-shadow: 0 3px 8px rgba(0,0,0,.15); 
}

/* ‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞ */
#trashBin {
  position: fixed;
  bottom: 20px;
  right: 20px;
  width: 90px;
  height: 90px;
  font-size: 48px;
  background: #ffcccc;
  border-radius: 14px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 3px 8px rgba(0,0,0,.25);
}

/* ‡πÄ‡∏Ñ‡πâ‡∏Å üéÇ */
.cake-wrapper {
  position: absolute;
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 100%;
  height: 600px;
  pointer-events: none; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏ö‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å */
}
.cake {
  font-size: 600px; /* ‡πÄ‡∏Ñ‡πâ‡∏Å‡πÉ‡∏´‡∏ç‡πà */
  text-align: center;
  line-height: 1;
  user-select: none;
}

/* ‡∏õ‡πâ‡∏≤‡∏¢‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
.sign {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: grab;
  touch-action: none;
}
.label {
  font-size: 14px;
  padding: 6px 12px;
  border-radius: 14px;
  white-space: nowrap;
  box-shadow: 0 3px 8px rgba(0,0,0,.15);
  color: #000;
}
.stick { width: 4px; height: 70px; background: #cdb4db; border-radius: 2px; }
</style>
</head>
<body>

<!-- Intro -->
<div class="screen intro active" id="intro">
  <h1>üéÇ Byebye 2025 üéÇ</h1>
  <input id="nameInput" placeholder="Your Name"><br>
  <button id="startBtn">Start üéâ</button>
</div>

<!-- Main App -->
<div class="screen app" id="app">
  <div class="welcome" id="welcomeText"></div>

  <input id="msg" placeholder="‚ú® Things I'm proud of this year ‚ú®">
  <button class="add-btn" id="addBtn">‚ûï Enter</button>

  <div class="controls">
    <div class="color-picker">
      <div class="color-btn active" data-color="#ffafcc" style="background:#ffafcc"></div>
      <div class="color-btn" data-color="#a2d2ff" style="background:#a2d2ff"></div>
      <div class="color-btn" data-color="#b7e4c7" style="background:#b7e4c7"></div>
      <div class="color-btn" data-color="#fff1a8" style="background:#fff1a8"></div>
      <div class="color-btn" data-color="#cdb4db" style="background:#cdb4db"></div>
    </div>
    <button id="exportBtn">üì∏ Export</button>
  </div>

  <div class="cake-wrapper">
    <div class="cake" id="cake">üéÇ</div>
  </div>
</div>

<div id="trashBin">üóëÔ∏è</div>

<!-- html2canvas -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase config
firebase.initializeApp({
  apiKey: "AIzaSyDTGOKNMwtoTsu_u6nCm_wKUQUSUZIflE4",
  authDomain: "goodjob-ffgk.firebaseapp.com",
  databaseURL: "https://goodjob-ffgk-default-rtdb.firebaseio.com",
  projectId: "goodjob-ffgk"
});
const db = firebase.database();

// Room
const params = new URLSearchParams(location.search);
const roomId = params.get("room") || "love";

const intro = document.getElementById("intro");
const app = document.getElementById("app");
const startBtn = document.getElementById("startBtn");
const welcomeText = document.getElementById("welcomeText");
const input = document.getElementById("msg");
const addBtn = document.getElementById("addBtn");
const trashBin = document.getElementById("trashBin");
const colorButtons = document.querySelectorAll(".color-btn");

let currentColor = "#ffafcc";

// Start app
startBtn.onclick = () => {
  welcomeText.innerText = `Our 2025 ‚ú®`;
  intro.classList.remove("active");
  app.classList.add("active");
};

// Select color
colorButtons.forEach(btn => {
  btn.onclick = () => {
    colorButtons.forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    currentColor = btn.dataset.color;
  };
});

// Add message
function sendMessage() {
  const text = input.value.trim();
  if (!text) return;
  db.ref(`rooms/${roomId}/signs`).push({
    text,
    color: currentColor,
    timestamp: Date.now()
  });
  input.value = "";
}
input.addEventListener("keydown", e => { if (e.key === "Enter") sendMessage(); });
addBtn.onclick = sendMessage;

// Listen realtime
db.ref(`rooms/${roomId}/signs`).on("child_added", snap => {
  const d = snap.val();
  createSignElement(d.text, d.color, snap.key);
});

// Create sign element
function createSignElement(text, color, key) {
  const sign = document.createElement("div");
  sign.className = "sign";
  sign.dataset.key = key;

  // label + stick
  const label = document.createElement("div");
  label.className = "label";
  label.innerText = text;
  label.style.background = color;

  const stick = document.createElement("div");
  stick.className = "stick";

  sign.append(label, stick);

  // default pos
  sign.style.left = "50px";
  sign.style.top = "50px";

  document.body.appendChild(sign);
  enableDrag(sign);
}

// Drag + delete
function enableDrag(el) {
  let ox=0, oy=0, dragging=false;

  el.addEventListener("pointerdown", e => {
    dragging = true;
    el.setPointerCapture(e.pointerId);
    ox = e.clientX - el.getBoundingClientRect().left;
    oy = e.clientY - el.getBoundingClientRect().top;
    el.style.position = "fixed";
  });

  el.addEventListener("pointermove", e => {
    if (!dragging) return;
    el.style.left = (e.clientX - ox) + "px";
    el.style.top = (e.clientY - oy) + "px";
  });

  el.addEventListener("pointerup", () => {
    dragging = false;
    // check trash collision
    const t = trashBin.getBoundingClientRect();
    const s = el.getBoundingClientRect();
    if (s.right > t.left && s.left < t.right && s.bottom > t.top && s.top < t.bottom) {
      db.ref(`rooms/${roomId}/signs/${el.dataset.key}`).remove();
      el.remove();
    }
  });
}

// Export image
document.getElementById("exportBtn").onclick = () => {
  html2canvas(document.querySelector(".cake-wrapper")).then(canvas => {
    const link = document.createElement("a");
    link.download = "cake-wish.png";
    link.href = canvas.toDataURL();
    link.click();
  });
};
</script>

</body>
</html>
